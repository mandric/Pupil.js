/*! Pupil 0.1.0 2013-08-27 */
!function(a){a.entities={};var b=function(b){a.entities[b]={name:b,toString:function(){return b}}};b("Block"),b("Func"),b("LogicalAnd"),b("LogicalOr"),b("LogicalNot")}(window.Pupil=window.Pupil||{}),function(a){var b;a.lexer=b={};var c=a.tokens;b.tokenize=function(a){a=a.replace(/([^\\])\s+/g,"$1");var b,d=a.split(""),e=[],f=function(a,b){e.push({name:a,data:b||null})},g="",h=!1,i=!0,j=[],k=!1;for(b=0;b<d.length;b++){var l=d[b],m=d[b+1];if(i=!0,j=[],k=!1,h?h=!1:"\\"==l?(h=!0,k=!0,i=!1):","==l?j.push([c.Comma]):":"==l?j.push([c.Colon]):"&"==l&&"&"==m?(j.push([c.LogicalAnd]),b++):"|"==l&&"|"==m?(j.push([c.LogicalOr]),b++):"!"==l?j.push([c.LogicalNot]):"("==l?j.push([c.BracketOpen]):")"==l&&j.push([c.BracketClose]),0!==j.length||k||(g+=l,i=!1),b==d.length-1&&(i=!0),i&&""!==g&&(j.unshift([c.Identifier,g]),g=""),j.length>0)for(var n=0;n<j.length;n++)f(j[n][0],j[n][1])}return e}}(window.Pupil=window.Pupil||{}),function(a){var b;a.parser=b={};var c=a.tokens,d=a.entities,e=function(a){return{type:a,sub:[],funcName:"",funcArgs:[]}},f=function(a,b){this.message=a,this.pos=b};b.parse=function(a){for(var b=e(d.Block),g=[b],h=g[g.length-1],i=null,j=!0,k={identifier:!0,logicalOp:!1,funcArgs:!1,argSeparator:!1,block:!0},l=0;l<a.length;l++){console.log(h);var m=a[l],n=[],o=!1,p=!1;if(m.name==c.Identifier){if(!k.identifier)throw new f("Got an identifier, was not expecting one",l);j=!1,i?(i.funcArgs.push(m.data),k.identifier=!1,k.logicalOp=!0,k.funcArgs=!1,k.argSeparator=!0,k.block=!0):(i=e(d.Func),i.funcName=m.data,k.identifier=!1,k.logicalOp=!0,k.funcArgs=!0,k.argSeparator=!1,k.block=!1)}else if(m.name==c.Colon){if(!k.funcArgs)throw new f("Got function arguments, was not expecting them",l);j=!1,k.identifier=!0,k.logicalOp=!1,k.funcArgs=!1,k.argSeparator=!1,k.block=!1}else if(m.name==c.Comma){if(!k.funcArgs)throw new f("Got function arguments, was not expecting them",l);j=!1,k.identifier=!0,k.logicalOp=!1,k.funcArgs=!1,k.argSeparator=!1,k.block=!1}else if(m.name==c.LogicalAnd){if(!k.logicalOp)throw new f("Got a logical operator (AND), was not expecting one",l);n.push(e(d.LogicalAnd)),j=!0,k.identifier=!0,k.logicalOp=!1,k.funcArgs=!1,k.argSeparator=!1,k.block=!0}else if(m.name==c.LogicalOr){if(!k.logicalOp)throw new f("Got a logical operator (OR), was not expecting one",l);n.push(e(d.LogicalOr)),j=!0,k.identifier=!0,k.logicalOp=!1,k.funcArgs=!1,k.argSeparator=!1,k.block=!0}else if(m.name==c.LogicalNot){if(!k.logicalOp)throw new f("Got a logical operator (NOT), was not expecting one",l);n.push(e(d.LogicalNot)),j=!0,k.identifier=!0,k.logicalOp=!1,k.funcArgs=!1,k.argSeparator=!1,k.block=!0}else if(m.name==c.BracketOpen){if(!k.block)throw new f("Got an opening bracket, was not expecting one",l);o=!0,j=!0,k.identifier=!0,k.logicalOp=!1,k.funcArgs=!1,k.argSeparator=!1,k.block=!0}else m.name==c.BracketClose&&(p=!0,j=!0,k.identifier=!0,k.logicalOp=!1,k.funcArgs=!1,k.argSeparator=!1,k.block=!0);if(l==a.length-1&&(j=!0),j&&i&&(n.unshift(i),i=null),n.length>0)for(var q=0;q<n.length;q++)h.sub.push(n[q]);if(o){var r=e(d.Block);g.push(r),h.sub.push(r),h=g[g.length-1]}if(p){if(1===g.length)throw new f("Can't close the root block.",l);g.pop(),h=g[g.length-1]}}if(g.length>1)throw new f("All blocks weren't closed.");return b}}(window.Pupil=window.Pupil||{}),function(a){var b=a.validatorFunctions;a.addFunction=function(a,c){b[a.toLowerCase()]=c}}(window.Pupil=window.Pupil||{}),function(a){a.tokens={};var b=function(b){a.tokens[b]={name:b,toString:function(){return b}}};b("Identifier"),b("Colon"),b("Comma"),b("LogicalAnd"),b("LogicalOr"),b("LogicalNot"),b("BracketOpen"),b("BracketClose")}(window.Pupil=window.Pupil||{}),function(a){var b;b=a.validator={};var c=a.validatorFunctions,d=a.entities;b.validate=function(a,e,f){for(var g=!0,h=1,i=!1,j=0;j<a.length;j++){var k=a[j],l=!0,m=!1;if(k.type==d.LogicalAnd)h=1;else if(k.type==d.LogicalOr)h=2;else if(k.type==d.LogicalNot)i=!0;else if(k.type==d.Func){var n=k.funcName.toLowerCase(),o=k.funcArgs;if("other"==n.substr(0,5)){n=substr(5);var p=o.shift();o.unshift(e[p])}else o.unshift(e[f]);o.unshift(e),l=c[n].apply(this,o)}else k.type==d.Block&&(l=b.validate(k,e,f));m&&(i&&(l=!l,i=!1),g=1==h?g&&l:g||l)}return g}}(window.Pupil=window.Pupil||{}),function(a){var b;a.validatorFunctions=b={},b.min=function(a,b,c){return parseInt(b,10)>=c},b.max=function(a,b,c){return parseInt(b,10)<=c}}(window.Pupil=window.Pupil||{});